openapi: 3.0.3
info:
  title: SkyTale API Documentation
  version: 1.0.0

servers:
  - url: "{server}"
    variables:
      server:
        default: "http://localhost:8080"

tags:
  - name: encode
    description: encode operations
  - name: decode
    description: decode operations
  - name: admin
    description: administrative operations


paths:
  /v1/encode:
    post:
      summary: Enqueues message to be encrypted.
      operationId: encodeMessage
      tags:
        - encode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EncodeMessageRequest'
      responses:
        201:
          description: Message queued for encryption.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EncodeMessageResponse'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /v1/decode:
    post:
      summary: Enqueues a request to decrypt an encoded message.
      operationId: decodeMessage
      tags:
        - decode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DecodeMessageRequest'
      responses:
        201:
          description: Message queued for decryption.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DecodeMessageResponse'
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  schemas:

    DecodeMessageRequest:
      description: Decode Message POST Request
      type: object
      properties:
        encode-uuid:
          description: uuid of encoded message to decrypt
          example: f1a59a5d-8b29-4cde-ba10-dc025c7c5042
          $ref: "#/components/schemas/UUID"

        secret:
          type: string
          description: client secret added to encryption context. must match the secret provided to the encode request.
          example: RQ!9*0XCDV5r*a98

    UUID:
      type: string
      format: uuid

    DecodeMessageResponse:
      description: Decode Message Response
      properties:
        decode-uuid:
          description: uuid of decrypted message
          example: 2c9d2718-e573-4de0-bad9-60e4384c4928
          $ref: "#/components/schemas/UUID"

    EncodeMessageRequest:
      description: Encode Message POST Request
      properties:
        message:
          type: string
          description: plaintext message to encrypt
          example: The chicken has flown the coop. I repeat. The chicken has flown the coop.
        secret:
          type: string
          description: client secret added to encryption context. the same secret must be provided on decode operations.
          example: RQ!9*0XCDV5r*a98

    EncodeMessageResponse:
      description: Encode Message Response
      properties:
        encode-uuid:
          description: uuid of encoded message
          example: f1a59a5d-8b29-4cde-ba10-dc025c7c5042
          $ref: "#/components/schemas/UUID"

    Error:
      description: "Error"
      type: object
      properties:
        code:
          description: "HTTP Status Code"
          type: integer
          format: int32
        message:
          description: "HTTP Status Message"
          type: string
        description:
          description: "Error description"
          type: string
        invalidParameters:
          $ref: "#/components/schemas/InvalidParameterArray"

    InvalidParameter:
      description: "Invalid Parameter"
      type: object
      properties:
        name:
          description: "Parameter name"
          type: string
        description:
          description: "Parameter description"
          type: string

    InvalidParameterArray:
      description: "Invalid parameter list"
      type: array
      items:
        $ref: "#/components/schemas/InvalidParameter"